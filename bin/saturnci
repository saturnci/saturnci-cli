#!/usr/bin/env ruby

require_relative "../lib/saturncicli/credential_loader"
require_relative "../lib/saturncicli/credential"
require_relative "../lib/saturncicli/client"
require_relative "../lib/saturncicli/arguments"

cache_file_path = File.join(Dir.home, ".saturnci", "cache.json")

credential = SaturnCICLI::Credential.new(
  **SaturnCICLI::CredentialLoader.values(env: ENV),
  cache_file_path: cache_file_path
)

return unless credential.valid?

client = SaturnCICLI::Client.new(credential)
arguments = SaturnCICLI::Arguments.new(ARGV)
client.execute(arguments.command)
